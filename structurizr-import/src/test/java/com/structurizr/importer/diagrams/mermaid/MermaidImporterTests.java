package com.structurizr.importer.diagrams.mermaid;

import com.structurizr.Workspace;
import com.structurizr.http.HttpClient;
import com.structurizr.view.ImageView;
import org.junit.jupiter.api.Tag;
import org.junit.jupiter.api.Test;

import java.io.File;

import static org.junit.jupiter.api.Assertions.*;

public class MermaidImporterTests {

    @Test
    public void importDiagram() throws Exception {
        Workspace workspace = new Workspace("Name", "Description");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_URL_PROPERTY, "https://mermaid.ink");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_COMPRESS_PROPERTY, "false");
        ImageView view = workspace.getViews().createImageView("key");

        new MermaidImporter().importDiagram(view, new File("./src/test/resources/diagrams/mermaid/flowchart.mmd"));
        assertEquals("key", view.getKey());
        assertNull(view.getElement());
        assertNull(view.getElementId());
        assertEquals("flowchart.mmd", view.getTitle());
        assertEquals("https://mermaid.ink/svg/Zmxvd2NoYXJ0IFRECiAgICBBW0NocmlzdG1hc10gLS0-fEdldCBtb25leXwgQihHbyBzaG9wcGluZykKICAgIEIgLS0-IEN7TGV0IG1lIHRoaW5rfQogICAgQyAtLT58T25lfCBEW0xhcHRvcF0KICAgIEMgLS0-fFR3b3wgRVtpUGhvbmVdCiAgICBDIC0tPnxUaHJlZXwgRltmYTpmYS1jYXIgQ2FyXQ==", view.getContent());
        assertEquals("image/svg+xml", view.getContentType());
    }

    @Test
    public void importDiagram_AsPNG() throws Exception {
        Workspace workspace = new Workspace("Name", "Description");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_URL_PROPERTY, "https://mermaid.ink");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_FORMAT_PROPERTY, "png");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_COMPRESS_PROPERTY, "false");
        ImageView view = workspace.getViews().createImageView("key");

        new MermaidImporter().importDiagram(view, new File("./src/test/resources/diagrams/mermaid/flowchart.mmd"));
        assertEquals("key", view.getKey());
        assertNull(view.getElement());
        assertNull(view.getElementId());
        assertEquals("flowchart.mmd", view.getTitle());
        assertEquals("https://mermaid.ink/img/Zmxvd2NoYXJ0IFRECiAgICBBW0NocmlzdG1hc10gLS0-fEdldCBtb25leXwgQihHbyBzaG9wcGluZykKICAgIEIgLS0-IEN7TGV0IG1lIHRoaW5rfQogICAgQyAtLT58T25lfCBEW0xhcHRvcF0KICAgIEMgLS0-fFR3b3wgRVtpUGhvbmVdCiAgICBDIC0tPnxUaHJlZXwgRltmYTpmYS1jYXIgQ2FyXQ==?type=png", view.getContent());
        assertEquals("image/png", view.getContentType());
    }

    @Test
    @Tag("IntegrationTest")
    public void importDiagram_AsInlinePNG() throws Exception {
        Workspace workspace = new Workspace("Name", "Description");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_URL_PROPERTY, "https://mermaid.ink");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_FORMAT_PROPERTY, "png");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_COMPRESS_PROPERTY, "true");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_INLINE_PROPERTY, "true");
        ImageView view = workspace.getViews().createImageView("key");

        HttpClient httpClient = new HttpClient();
        httpClient.allow(".*");

        new MermaidImporter(httpClient).importDiagram(view, new File("./src/test/resources/diagrams/mermaid/flowchart.mmd"));
        assertEquals("key", view.getKey());
        assertNull(view.getElement());
        assertNull(view.getElementId());
        assertEquals("flowchart.mmd", view.getTitle());
        assertEquals("data:image/png;base64,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", view.getContent());
        assertEquals("image/png", view.getContentType());
    }

    @Test
    public void importDiagram_AsSVG() throws Exception {
        Workspace workspace = new Workspace("Name", "Description");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_URL_PROPERTY, "https://mermaid.ink");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_FORMAT_PROPERTY, "svg");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_COMPRESS_PROPERTY, "false");
        ImageView view = workspace.getViews().createImageView("key");

        new MermaidImporter().importDiagram(view, new File("./src/test/resources/diagrams/mermaid/flowchart.mmd"));
        assertEquals("key", view.getKey());
        assertNull(view.getElement());
        assertNull(view.getElementId());
        assertEquals("flowchart.mmd", view.getTitle());
        assertEquals("https://mermaid.ink/svg/Zmxvd2NoYXJ0IFRECiAgICBBW0NocmlzdG1hc10gLS0-fEdldCBtb25leXwgQihHbyBzaG9wcGluZykKICAgIEIgLS0-IEN7TGV0IG1lIHRoaW5rfQogICAgQyAtLT58T25lfCBEW0xhcHRvcF0KICAgIEMgLS0-fFR3b3wgRVtpUGhvbmVdCiAgICBDIC0tPnxUaHJlZXwgRltmYTpmYS1jYXIgQ2FyXQ==", view.getContent());
        assertEquals("image/svg+xml", view.getContentType());
    }

    @Test
    @Tag("IntegrationTest")
    public void importDiagram_AsInlineSVG() throws Exception {
        Workspace workspace = new Workspace("Name", "Description");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_URL_PROPERTY, "https://mermaid.ink");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_FORMAT_PROPERTY, "svg");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_COMPRESS_PROPERTY, "false");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_INLINE_PROPERTY, "true");
        ImageView view = workspace.getViews().createImageView("key");

        HttpClient httpClient = new HttpClient();
        httpClient.allow(".*");

        new MermaidImporter(httpClient).importDiagram(view, new File("./src/test/resources/diagrams/mermaid/flowchart.mmd"));
        assertEquals("key", view.getKey());
        assertNull(view.getElement());
        assertNull(view.getElementId());
        assertEquals("flowchart.mmd", view.getTitle());
        assertTrue(view.getContent().startsWith("data:image/svg+xml;base64,"));
        assertEquals("image/svg+xml", view.getContentType());
    }

    @Test
    public void importDiagram_WhenTheMermaidUrlIsNotDefined() throws Exception {
        Workspace workspace = new Workspace("Name", "Description");
        ImageView view = workspace.getViews().createImageView("key");

        try {
            new MermaidImporter().importDiagram(view, new File("./src/test/resources/diagrams/mermaid/flowchart.mmd"));
            fail();
        } catch (IllegalArgumentException e) {
            assertEquals("Please define a view/viewset property named mermaid.url to specify your Mermaid server", e.getMessage());
        }
    }

    @Test
    public void importDiagram_WhenAnInvalidFormatIsSpecified() throws Exception {
        Workspace workspace = new Workspace("Name", "Description");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_URL_PROPERTY, "https://mermaid.ink");
        workspace.getViews().getConfiguration().addProperty(MermaidImporter.MERMAID_FORMAT_PROPERTY, "jpg");
        ImageView view = workspace.getViews().createImageView("key");

        try {
            new MermaidImporter().importDiagram(view, "...");
            fail();
        } catch (IllegalArgumentException e) {
            assertEquals("Expected a format of png or svg", e.getMessage());
        }
    }

}